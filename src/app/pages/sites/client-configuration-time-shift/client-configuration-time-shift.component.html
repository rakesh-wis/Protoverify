<div class="card">
	<div class="card-body">
		<div class="d-flex justify-content-between ign-items-center">
			<div class="d-flex">
				<h2 class="text-primary fs-3 fw-bold">Time Shift</h2>
			</div>
			<div class="d-flex text-end" (click)="toggleEdit()" *ngIf="dataForm.disabled" role="button">
				<mat-icon class="text-primary" style="height: 16px" svgIcon="pen-note-edit"></mat-icon>
				<a class="text-primary">Edit</a>
			</div>
		</div>
		<form [formGroup]="dataForm">
			<div class="row align-items-center" formArrayName="shifts" *ngFor="let _ of shifts.controls; let i = index">
				<div class="col-lg-3 col-md-4 col-sm-12 mb-3">
					<div class="form-group" [formGroupName]="i">
						<label class="form-label text-primary"> Select shift </label>
						<select class="form-select text-capitalize" aria-label="select example" formControlName="type">
							<option [value]="item.value" *ngFor="let item of timeShift">
								<span>{{ item.label }}</span>
							</option>
						</select>
						<div class="text-left" *ngFor="let error of errorMessages.type">
							<ng-container
								*ngIf="
									_.controls['type'].hasError(error.type) &&
									(_.controls['type'].dirty || _.controls['type'].touched)
								"
							>
								<span class="text-danger">{{ error.message }}</span>
							</ng-container>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-4 col-sm-12 mb-3">
					<div class="form-group" [formGroupName]="i">
						<label class="form-label text-primary">Name</label>
						<input type="text" class="form-control" id="name" placeholder="" formControlName="name" />
						<div class="text-left" *ngFor="let error of errorMessages.name">
							<ng-container
								*ngIf="
									_.controls['name'].hasError(error.type) &&
									(_.controls['name'].dirty || _.controls['name'].touched)
								"
							>
								<span class="text-danger">{{ error.message }}</span>
							</ng-container>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-4 col-sm-12 mb-3">
					<div class="form-group" [formGroupName]="i">
						<label class="form-label text-primary">Select Day(s)</label>
						<ng-select
							class="form-control text-capitalize"
							[items]="days"
							[multiple]="true"
							[dropdownPosition]="'bottom'"
							[closeOnSelect]="false"
							formControlName="days"
							[ngModelOptions]="{ standalone: true }"
							appendTo="body"
							placeholder=""
						>
							<ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
								<input
									id="item-{{ index }}"
									class="form-check-input"
									type="checkbox"
									[ngModel]="item$.selected"
									[ngModelOptions]="{ standalone: true }"
								/>
								{{ item }}
							</ng-template>
							<ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
								<div class="ng-value ps-2" *ngFor="let item of items | slice: 0:1">
									<span class="ng-value-label text-wrap">{{ item | truncate: 8 }}</span>
									<!-- <span class="ng-value-icon ps-2" aria-hidden="true">,</span> -->
								</div>
								<div class="ng-value ps-2" *ngIf="items.length > 1">
									<span class="ng-value-label ps-2">{{ items.length - 1 }} more...</span>
								</div>
							</ng-template>
						</ng-select>
						<div class="text-left" *ngFor="let error of errorMessages.days">
							<ng-container
								*ngIf="
									_.controls['days'].hasError(error.type) &&
									(_.controls['days'].dirty || _.controls['days'].touched)
								"
							>
								<span class="text-danger">{{ error.message }}</span>
							</ng-container>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-4 col-sm-12 mb-3">
					<div class="form-group" [formGroupName]="i">
						<label class="form-label text-primary">Select start time</label>
						<input
							type="time"
							class="form-control"
							id="startTime"
							placeholder=""
							formControlName="startTime"
						/>
						<div class="text-left" *ngFor="let error of errorMessages.startTime">
							<ng-container
								*ngIf="
									_.controls['startTime'].hasError(error.type) &&
									(_.controls['startTime'].dirty || _.controls['startTime'].touched)
								"
							>
								<span class="text-danger">{{ error.message }}</span>
							</ng-container>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-4 col-sm-12 mb-3">
					<div class="form-group" [formGroupName]="i">
						<label class="form-label text-primary">Select end time</label>
						<input type="time" class="form-control" id="endTime" placeholder="" formControlName="endTime" />
						<div class="text-left" *ngFor="let error of errorMessages.endTime">
							<ng-container
								*ngIf="
									_.controls['endTime'].hasError(error.type) &&
									(_.controls['endTime'].dirty || _.controls['endTime'].touched)
								"
							>
								<span class="text-danger">{{ error.message }}</span>
							</ng-container>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-4 col-sm-12 mb-3" *ngIf="!_.controls['id'].value">
					<button type="button" class="btn btn-outline-danger mt-3" (click)="removeItem(i)">Remove</button>
				</div>
			</div>
		</form>
		<div class="d-flex justify-content-end mb-3" *ngIf="dataForm.enabled">
			<a class="text-primary" role="button" (click)="addItems()">Add new</a>
		</div>
		<div class="d-flex justify-content-end" *ngIf="!dataForm.disabled">
			<button type="button" class="btn btn-outline-primary" (click)="toggleEdit()" *ngIf="shifts.length > 1">
				Cancel
			</button>
			<button type="button" class="btn btn-primary ms-4" (click)="onSubmit()">Submit</button>
		</div>
	</div>
</div>
