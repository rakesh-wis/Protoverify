<div class="container-fluid page-padding">
	<div
		class="d-flex justify-content-between align-items-center"
		*ngIf="![roles.EMPLOYEE].includes(currentUser?.role)"
	>
		<label class="text-custom-black-80 fs-4 fw-bold"> {{ userData?.name }}'s Verification Details </label>
	</div>
	<div *ngIf="![roles.EMPLOYEE].includes(currentUser?.role)">
		<app-status-bar
			[checkName]="'educational'"
			[inputData]="form['status'].value ? dataForm.getRawValue() : null"
			[currentUser]="currentUser"
		>
		</app-status-bar>
	</div>
	<div class="d-flex justify-content-end">
		<div
			*ngIf="
				[roles.EMPLOYEE].includes(currentUser?.role) &&
				dataList.count < maxUploadNumber &&
				![verificationLevel.CLEAR_REPORT].includes(form['status'].value)
			"
		>
			<div class="text-end">
				<button type="button" class="btn btn-primary" (click)="add()">+ Add Education</button>
			</div>
		</div>
		<div
			class="mt-2"
			*ngIf="
				[roles.PROTO_SUPER_ADMIN, roles.PROTO_ADMIN, roles.PROTO_USER, roles.PROTO_OPERATION].includes(
					currentUser?.role
				) && dataList.count < maxUploadNumber
			"
		>
			<div class="text-end" *appIsGranted="'ADD'">
				<button type="button" class="btn btn-primary" (click)="add()" [disabled]="dataForm.disabled">
					+ Add Education
				</button>
			</div>
		</div>
	</div>

	<div class="card my-4 px-3" [ngClass]="{ 'opacity-50': isFormDisabled }">
		<div class="card-header bg-transparent">
			<div class="d-flex justify-content-between align-items-center">
				<div class="d-flex justify-content-start align-items-center py-2">
					<img src="assets/images/kyc_education.svg" class="img-fluid" />
					<h2 class="text-custom-black-80 fw-bold mb-0 ms-3">Education Check</h2>
				</div>
				<div>
					<span class="badge badge-primary fw-normal"
						>Details of latest <strong>{{ maxUploadNumber }} Education</strong> requested</span
					>
				</div>
			</div>
		</div>
	</div>
	<ng-container>
		<div class="table-responsive mt-3" [ngClass]="{ 'opacity-50': isFormDisabled }">
			<table class="table table-hover table-striped">
				<thead>
					<tr>
						<ng-container *ngFor="let item of headerColumn">
							<th scope="col" *ngIf="item.sorting" [sortable]="item.value" (sort)="onSort($event)">
								{{ item.label }}
							</th>
							<th scope="col" *ngIf="!item.sorting">
								{{ item.label }}
							</th>
						</ng-container>
					</tr>
				</thead>
				<tbody *ngIf="dataList?.count > 0">
					<tr *ngFor="let item of dataList['rows']">
						<td class="text-capitalize text-wrap">
							<p class="d-flex flex-column">
								<span>{{ item?.board | truncate }}</span>
							</p>
						</td>
						<td class="text-wrap">
							<p class="d-flex flex-column">
								<span>{{ item?.college | truncate }}</span>
							</p>
						</td>
						<td class="text-wrap">
							<p class="d-flex flex-column">
								<span>{{ item?.yearOfPassing | truncate }}</span>
							</p>
						</td>
						<td>
							<p class="d-flex flex-column fw-bold gap-1">
								<span
									class="d-flex align-item-center"
									(click)="dataForm.disabled ? null : downloadDocument(item.certificateDocument)"
									role="button"
									*ngIf="item.certificateDocument"
								>
									<span class="text-decoration-underline"
										>Certificate.{{ getFileType(item.certificateDocument) }}</span
									>
									<mat-icon mat-list-icon class="text-medium text-primary ms-2 mt-1">
										visibility
									</mat-icon>
								</span>
								<span
									class="d-flex align-item-center"
									(click)="dataForm.disabled ? null : downloadDocument(item.passingDocument)"
									role="button"
									*ngIf="item.passingDocument"
								>
									<span class="text-decoration-underline"
										>Passing.{{ getFileType(item.passingDocument) }}</span
									>
									<mat-icon mat-list-icon class="text-medium text-primary ms-2 mt-1">
										visibility
									</mat-icon>
								</span>
								<span
									class="d-flex align-item-center"
									(click)="dataForm.disabled ? null : downloadDocument(item.leavingDocument)"
									role="button"
									*ngIf="item.leavingDocument"
								>
									<span class="text-decoration-underline"
										>Final Year Marksheet.{{ getFileType(item.leavingDocument) }}</span
									>
									<mat-icon mat-list-icon class="text-medium text-primary ms-2 mt-1">
										visibility
									</mat-icon>
								</span>
								<span
									class="d-flex align-item-center"
									(click)="dataForm.disabled ? null : downloadDocument(item.finalYearDocument)"
									role="button"
									*ngIf="item.finalYearDocument"
								>
									<span class="text-decoration-underline"
										>Leaving.{{ getFileType(item.finalYearDocument) }}</span
									>
									<mat-icon mat-list-icon class="text-medium text-primary ms-2 mt-1">
										visibility
									</mat-icon>
								</span>
							</p>
						</td>

						<!-- <td>
							<ng-container *appIsGranted="'EDIT'">
								<div ngbDropdown container="body" *ngIf="currentUser?.role != roles.PROTO_LAWYER">
									<span type="button" ngbDropdownToggle>
										<mat-icon>more_vert</mat-icon>
									</span>
									<div ngbDropdownMenu>
										<button ngbDropdownItem class="btn" *appIsGranted="'EDIT'"
											(click)="update(item)">
											Edit
										</button>
										<button ngbDropdownItem class="btn text-danger" *appIsGranted="'DELETE'"
											(click)="openConfirmDelete(item)">
											Delete
										</button>
									</div>
								</div>
							</ng-container>
						</td> -->
					</tr>
				</tbody>
				<tbody *ngIf="dataList?.count == 0">
					<tr>
						<td class="text-center" [attr.colspan]="headerColumn.length">{{ OPTIONS?.noRecord }}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</ng-container>

	<div class="card my-3" *ngFor="let item of dataList['rows']">
		<div class="card-body">
			<app-educational-details
				(updateEvent)="triggerEvent($event, item)"
				[userId]="userId"
				[isPopup]="false"
				[modelData]="item"
			></app-educational-details>
		</div>
	</div>

	<form
		[formGroup]="dataForm"
		*ngIf="
			dataList['rows']?.length > 0 &&
			[roles.PROTO_SUPER_ADMIN, roles.PROTO_ADMIN, roles.PROTO_LAWYER, roles.PROTO_OPERATION].includes(
				currentUser?.role
			)
		"
	>
		<div class="row" [ngClass]="{ 'opacity-50': isFormDisabled }">
			<div class="col-lg-6 col-md-6 col-sm-12">
				<div class="form-group">
					<label class="form-label text-custom-black">
						<span> Select Vendor* </span>
					</label>
					<div class="input-group">
						<ng-select
							#select
							class="form-control text-capitalize bg-white-200 mb-0"
							[items]="vendorList"
							[virtualScroll]="true"
							bindLabel="name"
							bindValue="id"
							[dropdownPosition]="'bottom'"
							[searchable]="false"
							[clearable]="false"
							appendTo="body"
							placeholder=""
							formControlName="vendorId"
							(scrollToEnd)="onScrollVendor()"
							(search)="searchVendor($event)"
							(change)="onVendorSelect()"
						>
							<ng-template ng-label-tmp let-item="item">
								{{ item?.name }}
							</ng-template>
						</ng-select>
						<button
							class="btn btn-outline-send py-1"
							type="button"
							(click)="sendEmailToVendor()"
							[disabled]="dataForm.disabled"
						>
							<iconify-icon class="fs-5 pt-1 text-primary" icon="bi:send"></iconify-icon>
						</button>
					</div>
					<div class="text-left" *ngFor="let error of errorMessages.vendorId">
						<ng-container
							*ngIf="
								form['vendorId'].hasError(error.type) &&
								(form['vendorId'].dirty || form['vendorId'].touched)
							"
						>
							<span class="text-danger"> {{ error.message }} Vendor </span>
						</ng-container>
					</div>
				</div>
			</div>
		</div>

		<div class="row" [ngClass]="{ 'opacity-50': isFormDisabled }">
			<div class="col-12 mb-3">
				<div class="form-group">
					<label class="form-label text-primary">Remarks</label>
					<textarea
						type="text"
						class="form-control"
						id="remark"
						placeholder="Write your remarks here"
						rows="4"
						formControlName="remark"
						[readOnly]="
							dataForm?.value?.status === kycStatus?.APPROVED ||
							![roles.PROTO_SUPER_ADMIN, roles.PROTO_ADMIN, roles.PROTO_OPERATION].includes(
								currentUser?.role
							)
						"
					></textarea>
					<div class="text-left" *ngFor="let error of errorMessages?.remark">
						<ng-container
							*ngIf="
								form['remark'].hasError(error.type) && (form['remark'].dirty || form['remark'].touched)
							"
						>
							<span class="text-danger">{{ error.message }}</span>
						</ng-container>
					</div>
				</div>
			</div>
		</div>
	</form>
	<div class="gap-1" *appIsGranted="'EDIT'">
		<div
			class="d-flex justify-content-end gap-1"
			*ngIf="
				[roles.PROTO_SUPER_ADMIN, roles.PROTO_ADMIN].includes(currentUser?.role) && dataList['rows']?.length > 0
			"
		>
			<button
				type="button"
				class="btn btn-outline-danger text-capitalize"
				class="btn btn-outline-danger text-capitalize"
				(click)="openConfirmStatus()"
			>
				Discrepancy
			</button>
			<button type="button" class="btn btn-success" (click)="openConfirmStatus(verificationLevel.CLEAR_REPORT)">
				Clear Report
			</button>
		</div>
		<div
			class="d-flex justify-content-between gap-1"
			*ngIf="[roles.PROTO_OPERATION].includes(currentUser?.role) && dataList['rows']?.length > 0"
			[ngClass]="{ 'opacity-50': isFormDisabled }"
		>
			<button
				type="button"
				class="btn btn-outline-danger text-capitalize"
				(click)="openConfirmStatus(verificationLevel.MAJOR_DISCREPANCY)"
				[disabled]="dataForm.disabled"
			>
				Major Discrepancy
			</button>
			<button
				type="button"
				class="btn btn-outline-primary text-capitalize"
				(click)="openConfirmStatus('others')"
				[disabled]="dataForm.disabled"
			>
				others
			</button>
			<button
				type="button"
				class="btn btn-success"
				(click)="openConfirmStatus(verificationLevel.CLEAR_REPORT)"
				[disabled]="dataForm.disabled"
			>
				Clear Report
			</button>
		</div>
	</div>
	<div class="d-flex justify-content-end mt-5">
		<button type="button" class="btn-preview border-0" (click)="goBack()">
			<img src="assets/icons/arrow-left.svg" class="img-fluid" alt="clip" /> Previous
		</button>
		<button type="button" class="btn-next border-0" (click)="goNext()">
			Next <img src="assets/icons/arrow-right.svg" class="img-fluid" alt="clip" />
		</button>
	</div>

	<div class="mt-4" *ngIf="![roles.EMPLOYEE].includes(currentUser?.role)">
		<app-verification-status></app-verification-status>
	</div>
</div>
